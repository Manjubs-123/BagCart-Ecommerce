<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Signup | BagHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gray-50 text-gray-900 font-sans">
    <!-- Header -->
    <%- include('../partials/header') %>

    <!-- Signup Section -->
    <section class="flex justify-center items-center min-h-screen bg-gray-50 px-4">
      <div class="w-full max-w-md bg-white p-8 rounded-xl shadow-lg border">
        <h2 class="text-2xl font-bold mb-6 text-center text-emerald-800">Create Account</h2>

        <!-- Error message -->
        <div
          id="errorMessage"
          class="bg-red-100 text-red-700 p-3 mb-4 rounded text-sm text-center hidden"
        ></div>

        <!-- Signup Form -->
        <form id="signupForm" action="/user/signup" method="POST" class="space-y-4">
          <!-- Name -->
          <div>
            <label for="name" class="block text-sm font-medium mb-1">Full Name</label>
            <input
              id="name"
              name="name"
              type="text"
              placeholder="Enter your full name"
              class="w-full border px-3 py-2 rounded-lg focus:outline-none focus:ring-2"
              required
            />
            <p id="nameError" class="text-red-600 text-sm mt-1 hidden">
              Name must be at least 6 characters long and contain only letters.
            </p>
          </div>

          <!-- Email -->
          <div>
            <label for="email" class="block text-sm font-medium mb-1">Email</label>
            <input
              id="email"
              name="email"
              type="email"
              placeholder="Enter your email"
              class="w-full border px-3 py-2 rounded-lg focus:outline-none focus:ring-2"
              required
            />
            <p id="emailError" class="text-red-600 text-sm mt-1 hidden">
              Please enter a valid Gmail address.
            </p>
          </div>

          <!-- Password -->
          <div>
            <label for="password" class="block text-sm font-medium mb-1">Password</label>
            <input
              id="password"
              name="password"
              type="password"
              placeholder="Enter a strong password"
              class="w-full border px-3 py-2 rounded-lg focus:outline-none focus:ring-2"
              required
            />
            <p id="passwordError" class="text-red-600 text-sm mt-1 hidden">
              Password must have 6+ characters, 1 uppercase, 1 number, and 1 special character.
            </p>
          </div>

          <!-- Confirm Password -->
          <div>
            <label for="confirmPassword" class="block text-sm font-medium mb-1">Confirm Password</label>
            <input
              id="confirmPassword"
              name="confirmPassword"
              type="password"
              placeholder="Confirm your password"
              class="w-full border px-3 py-2 rounded-lg focus:outline-none focus:ring-2"
              required
            />
            <p id="confirmError" class="text-red-600 text-sm mt-1 hidden">
              Passwords do not match.
            </p>
          </div>

          <!-- Submit -->
          <button
            type="submit"
            class="w-full bg-emerald-800 text-white py-2 rounded-lg hover:bg-emerald-700 transition"
          >
            Sign Up
          </button>
        </form>

        <!-- Google Signup -->
        <div class="text-center mt-4">
          <p class="text-gray-600 text-sm mb-2">or sign up with</p>
          <a
            href="/auth/google"
            class="flex items-center justify-center gap-2 w-full border py-2 rounded-lg hover:bg-gray-100 transition"
          >
            <img
              src="https://www.svgrepo.com/show/355037/google.svg"
              alt="Google"
              class="w-5 h-5"
            />
            <span>Sign up with Google</span>
          </a>
        </div>

        <div class="text-center mt-6">
          <p class="text-sm text-gray-700">
            Already have an account?
            <a href="/user/login" class="text-emerald-700 hover:underline font-semibold">Login</a>
          </p>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <%- include('../partials/footer') %>

    <!-- Real-time + Blur Validation Script -->
    <script>
      const form = document.getElementById("signupForm");
      const fields = {
        name: document.getElementById("name"),
        email: document.getElementById("email"),
        password: document.getElementById("password"),
        confirm: document.getElementById("confirmPassword"),
      };

      const errors = {
        name: document.getElementById("nameError"),
        email: document.getElementById("emailError"),
        password: document.getElementById("passwordError"),
        confirm: document.getElementById("confirmError"),
      };

      const errorMessage = document.getElementById("errorMessage");

      const regex = {
        name: /^[a-zA-Z\s]{6,}$/,
        email: /^[a-zA-Z0-9._%+-]+@gmail\.com$/,
        password: /^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+{}:"<>?~]).{6,}$/,
      };

      const messages = {
        name: "Name must be at least 6 letters long.",
        email: "Please enter a valid Gmail address.",
        password: "Password must have 6+ chars, 1 uppercase, 1 number, and 1 special char.",
        confirm: "Passwords do not match.",
      };

      function setValidationState(input, errorEl, valid, msg = "") {
        if (valid) {
          errorEl.classList.add("hidden");
          input.classList.remove("border-red-500");
          input.classList.add("border-green-500");
        } else {
          errorEl.textContent = msg;
          errorEl.classList.remove("hidden");
          input.classList.add("border-red-500");
          input.classList.remove("border-green-500");
        }
      }

      function validateField(fieldName) {
        const input = fields[fieldName];
        const value = input.value.trim();
        let valid = false;

        switch (fieldName) {
          case "name":
            valid = regex.name.test(value);
            break;
          case "email":
            valid = regex.email.test(value);
            break;
          case "password":
            valid = regex.password.test(value);
            break;
          case "confirm":
            valid = value === fields.password.value && value !== "";
            break;
        }

        setValidationState(input, errors[fieldName], valid, messages[fieldName]);
        return valid;
      }

      // Add real-time + blur validation for all fields
      Object.keys(fields).forEach((field) => {
        const input = fields[field];
        input.addEventListener("input", () => validateField(field));
        input.addEventListener("blur", () => validateField(field));
      });

      // If user skips a field and jumps to next, mark previous invalid
      Object.keys(fields).forEach((field, i, arr) => {
        const next = arr[i + 1];
        if (next) {
          fields[next].addEventListener("focus", () => {
            validateField(field);
          });
        }
      });

      // On form submit
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        let allValid = true;

        Object.keys(fields).forEach((field) => {
          const valid = validateField(field);
          if (!valid) allValid = false;
        });

        if (!allValid) {
          errorMessage.textContent = "Please fix the highlighted errors before submitting.";
          errorMessage.classList.remove("hidden");
          return;
        }

        errorMessage.classList.add("hidden");
        form.submit();
      });
    </script>
    <script>
  if (window.history && window.history.replaceState) {
    window.history.pushState(null, null, window.location.href);
    window.onpopstate = function () {
      window.history.go(1);
    };
  }
</script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= product.productName %> - BagHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a56db;
            --primary-dark: #1e429f;
            --secondary: #047857;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(26, 86, 219, 0.3);
        }

        .info-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border: 1px solid #f3f4f6;
        }

        .color-option {
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            background: white;
        }

        .color-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .color-option.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, #f0f9ff, #e1f5fe);
            box-shadow: 0 4px 6px rgba(26, 86, 219, 0.1);
        }

        .color-swatch {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid #e5e7eb;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .color-select-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 8px;
        }

        .color-option-content {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-name {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            text-transform: capitalize;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            background: white;
        }

        .quantity-btn {
            width: 44px;
            height: 44px;
            border: none;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
            color: #6b7280;
        }

        .quantity-btn:hover {
            background-color: #f8fafc;
            color: var(--primary);
        }

        .quantity-input {
            width: 60px;
            text-align: center;
            border: none;
            outline: none;
            background: white;
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .discount-badge {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .featured-badge {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        * {box-sizing: border-box;}

.img-zoom-container {
  position: relative;
}

.img-zoom-lens {
  position: absolute;
  border: 1px solid #d4d4d4;
  /*set the size of the lens:*/
  width: 40px;
  height: 40px;
}

.img-zoom-result {
  border: 1px solid #d4d4d4;
  /*set the size of the result div:*/
  width: 300px;
  height: 300px;
}
    </style>
    <script>
function imageZoom(imgID, resultID) {
  var img, lens, result, cx, cy;
  img = document.getElementById(imgID);
  result = document.getElementById(resultID);
  /*create lens:*/
  lens = document.createElement("DIV");
  lens.setAttribute("class", "img-zoom-lens");
  /*insert lens:*/
  img.parentElement.insertBefore(lens, img);
  /*calculate the ratio between result DIV and lens:*/
  cx = result.offsetWidth / lens.offsetWidth;
  cy = result.offsetHeight / lens.offsetHeight;
  /*set background properties for the result DIV:*/
  result.style.backgroundImage = "url('" + img.src + "')";
  result.style.backgroundSize = (img.width * cx) + "px " + (img.height * cy) + "px";
  /*execute a function when someone moves the cursor over the image, or the lens:*/
  lens.addEventListener("mousemove", moveLens);
  img.addEventListener("mousemove", moveLens);
  /*and also for touch screens:*/
  lens.addEventListener("touchmove", moveLens);
  img.addEventListener("touchmove", moveLens);
  function moveLens(e) {
    var pos, x, y;
    /*prevent any other actions that may occur when moving over the image:*/
    e.preventDefault();
    /*get the cursor's x and y positions:*/
    pos = getCursorPos(e);
    /*calculate the position of the lens:*/
    x = pos.x - (lens.offsetWidth / 2);
    y = pos.y - (lens.offsetHeight / 2);
    /*prevent the lens from being positioned outside the image:*/
    if (x > img.width - lens.offsetWidth) {x = img.width - lens.offsetWidth;}
    if (x < 0) {x = 0;}
    if (y > img.height - lens.offsetHeight) {y = img.height - lens.offsetHeight;}
    if (y < 0) {y = 0;}
    /*set the position of the lens:*/
    lens.style.left = x + "px";
    lens.style.top = y + "px";
    /*display what the lens "sees":*/
    result.style.backgroundPosition = "-" + (x * cx) + "px -" + (y * cy) + "px";
  }
  function getCursorPos(e) {
    var a, x = 0, y = 0;
    e = e || window.event;
    /*get the x and y positions of the image:*/
    a = img.getBoundingClientRect();
    /*calculate the cursor's x and y coordinates, relative to the image:*/
    x = e.pageX - a.left;
    y = e.pageY - a.top;
    /*consider any page scrolling:*/
    x = x - window.pageXOffset;
    y = y - window.pageYOffset;
    return {x : x, y : y};
  }
}
</script>
</head>
<body class="bg-gray-50">
   <%- include('../partials/landingheader') %>

    <!-- Product Details Section -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12">
            <!-- Product Images Gallery -->
            <div class="flex flex-col gap-4">
                <!-- Main Image with Amazon Zoom -->
                <div class="zoom-container bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden h-96 lg:h-[500px] relative"
                     onmousemove="moveLens(event)" 
                     onmouseenter="showZoom()" 
                     onmouseleave="hideZoom()">
                    <img id="mainImage"
                         src="<%= allProductImages && allProductImages.length > 0 ? allProductImages[0] : '/images/image 73.png' %>"
                         alt="<%= product.productName %>"
                         class="zoom-image p-4"
                         data-zoom-src="<%= allProductImages && allProductImages.length > 0 ? allProductImages[0] : '/images/image 73.png' %>">
                    
                    <div class="zoom-lens" id="zoomLens"></div>
                    <div class="zoom-result" id="zoomResult">
                        <img class="zoom-result-img" id="zoomResultImg">
                    </div>

                    <!-- Badges -->
                    <div class="absolute top-4 left-4 flex flex-col gap-2">
                        <% if (product.isFeatured) { %>
                            <span class="featured-badge text-white text-xs font-semibold px-3 py-1 rounded-full">
                                <i class="fas fa-star mr-1"></i>Featured
                            </span>
                        <% } %>
                        <% if (product.regularPrice && product.salePrice) { %>
                            <% let discount = Math.round(((product.regularPrice - product.salePrice) / product.regularPrice) * 100); %>
                            <span class="discount-badge text-white text-xs font-semibold px-3 py-1 rounded-full">
                                <i class="fas fa-tag mr-1"></i><%= discount %>% OFF
                            </span>
                        <% } %>
                    </div>

                    <!-- Wishlist Button -->
                    <div class="absolute top-4 right-4">
                        <button onclick="toggleWishlist('<%= product._id %>')" 
                                class="wishlist-btn bg-white rounded-full p-3 shadow-md hover:shadow-lg transition">
                            <i id="wishlistIcon" class="far fa-heart text-gray-400 text-lg"></i>
                        </button>
                    </div>
                </div>

                <!-- Thumbnail Images -->
                <!-- <% if (allProductImages && allProductImages.length > 1) { %>
                    <div class="grid grid-cols-4 gap-4">
                        <% allProductImages.forEach((image, index) => { %>
                            <button onclick="changeMainImage('<%= image %>', this)"
                                    class="bg-white rounded-lg overflow-hidden border-2 border-gray-200 hover:border-blue-500 transition-all h-24 <%= index === 0 ? 'border-blue-500' : '' %>">
                                <img src="<%= image %>" alt="Product thumbnail <%= index + 1 %>" class="w-full h-full object-contain p-2">
                            </button>
                        <% }); %>
                    </div>
                <% } %> -->
                <!-- Variant-specific thumbnails -->
<div id="thumbnailContainer" class="grid grid-cols-4 gap-4">
  <% if (allProductImages && allProductImages.length > 0) { %>
    <% allProductImages.forEach((image, index) => { %>
      <button onclick="changeMainImage('<%= image %>', this)"
              class="bg-white rounded-lg overflow-hidden border-2 border-gray-200 hover:border-blue-500 transition-all h-24 <%= index === 0 ? 'border-blue-500' : '' %>">
        <img src="<%= image %>" alt="Product thumbnail <%= index + 1 %>" class="w-full h-full object-contain p-2">
      </button>
    <% }); %>
  <% } %>
</div>
            </div>

            <!-- Product Information -->
            <div class="space-y-6">
                <!-- Product Header -->
                <div class="info-card fade-in">
                    <!-- Product Name -->
<h1 id="productName" class="text-3xl lg:text-4xl font-bold text-gray-900 mb-4">
    <%= product.productName %>
</h1>
                    <!-- <h1 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-4">
                        <%= product.productName %>
                    </h1> -->
                    
                    <!-- Rating and Reviews -->
                    <div class="flex items-center gap-4 mb-4">
                        <div class="flex items-center bg-blue-50 px-3 py-1 rounded-full">
                            <div class="flex items-center mr-2">
                                <% for (let i = 0; i < 5; i++) { %>
                                    <i class="fas fa-star text-amber-400 text-sm <%= i < Math.floor(product.rating || 0) ? 'fas' : 'far' %>"></i>
                                <% } %>
                            </div>
                            <span class="text-sm font-semibold text-blue-700"><%= (product.rating || 0).toFixed(1) %></span>
                        </div>
                        <span class="text-sm text-gray-600"><%= product.reviews || 0 %> Reviews</span>
                        <span class="text-sm text-green-600 font-semibold">
                            <i class="fas fa-check-circle mr-1"></i>In Stock
                        </span>
                    </div>

                    <!-- Price Section -->
                     <div id="priceSection" class="flex items-center gap-4 mb-2">
    <span id="productPrice" class="text-3xl font-bold text-gray-900">â‚¹<%= product.salePrice %></span>
    <% if (product.regularPrice) { %>
        <span id="productMrp" class="text-xl text-gray-500 line-through">â‚¹<%= product.regularPrice %></span>
        <% let discount = Math.round(((product.regularPrice - product.salePrice) / product.regularPrice) * 100); %>
        <span id="productDiscount" class="text-lg font-semibold text-green-600">
            Save <%= discount %>%
        </span>
    <% } %>
</div>
                    <!-- <div class="flex items-center gap-4 mb-2">
                        <span class="text-3xl font-bold text-gray-900">â‚¹<%= product.salePrice %></span>
                        <% if (product.regularPrice) { %>
                            <span class="text-xl text-gray-500 line-through">â‚¹<%= product.regularPrice %></span>
                            <% let discount = Math.round(((product.regularPrice - product.salePrice) / product.regularPrice) * 100); %>
                            <span class="text-lg font-semibold text-green-600">
                                Save <%= discount %>%
                            </span>
                        <% } %>
                    </div>
                </div> -->

                <!-- Color Selection -->
                <% if (product.colors && product.colors.length > 0) { %>
                    <div class="info-card fade-in">
                        <label class="block text-lg font-semibold text-gray-900 mb-4">Select Color</label>
                        <div class="color-select-container">
                            <% product.colors.forEach((color, index) => { %>
                                <div class="color-option <%= index === 0 ? 'selected' : '' %>"
                                     onclick="selectColor('<%= color %>')"
                                     data-color="<%= color %>">
                                    <div class="color-option-content">
<div class="color-swatch" style="background-color: <%= colorMap[color.toLowerCase()] || '#6b7280' %>"></div>
                                        <span class="color-name"><%= color %></span>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    </div>
                <% } %>

            

                <!-- Quantity Selection -->
                <div class="info-card fade-in">
                    <label class="block text-lg font-semibold text-gray-900 mb-4">Quantity</label>
                    <div class="flex items-center gap-6">
                        <div class="quantity-selector">
                            <button onclick="decreaseQty()" class="quantity-btn rounded-l-lg">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input id="quantity" type="number" value="1" min="1" max="<%= product.stock || 100 %>"
                                   class="quantity-input">
                            <button onclick="increaseQty()" class="quantity-btn rounded-r-lg">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <!-- <span class="text-sm text-gray-600">
                            <i class="fas fa-check-circle text-green-500 mr-1"></i>
                            <%= product.stock || 100 %> available in stock
                        </span> -->
                         <span class="text-sm text-green-600 font-semibold">
                            <i class="fas fa-check-circle mr-1"></i>In Stock
                        </span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4">
                    <button onclick="addToCart()"
                            class="flex-1 btn-primary text-white py-4 rounded-xl font-semibold flex items-center justify-center gap-3 text-lg">
                        <i class="fas fa-shopping-cart"></i>
                        Add to Cart
                    </button>
                    <button onclick="buyNow()"
                            class="flex-1 bg-gray-900 text-white py-4 rounded-xl font-semibold hover:bg-gray-800 transition flex items-center justify-center gap-3 text-lg">
                        <i class="fas fa-bolt"></i>
                        Buy Now
                    </button>
                </div>

                <!-- Product Features -->
                <div class="info-card fade-in">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Product Features</h3>
                    <ul class="space-y-3">
                        <% if (product.description) { %>
                            <li class="text-gray-700 flex items-start gap-2">
                                <span class="text-blue-600 mt-1">â€¢</span>
                                <span><%= product.description %></span>
                            </li>
                        <% } %>
                        <% if (product.productFeatures && Array.isArray(product.productFeatures)) { %>
                            <% product.productFeatures.forEach(feature => { %>
                                <li class="text-gray-700 flex items-start gap-2">
                                    <span class="text-blue-600 mt-1">â€¢</span>
                                    <span><%= feature %></span>
                                </li>
                            <% }); %>
                        <% } %>
                    </ul>
                </div>

                <!-- Additional Info -->
                <div class="info-card fade-in">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Product Information</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">SKU:</span>
                            <span class="font-semibold text-gray-900"><%= product.sku || 'N/A' %></span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Category:</span>
                            <span class="font-semibold text-gray-900"><%= product.category?.name || 'Uncategorized' %></span>
                        </div>
                        <!-- <% if (product.material) { %>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Material:</span>
                                <span class="font-semibold text-gray-900"><%= product.material %></span>
                            </div>
                        <% } %> -->
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Brand:</span>
                            <span class="font-semibold text-gray-900"><%= product.brand || 'BagHub' %></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

  <!-- Similar Products Section -->
<!-- Similar Products Section -->
<section class="bg-white py-16 border-t border-gray-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between mb-8">
      <h2 class="text-3xl font-bold text-gray-900">
        Similar Products 
        <% if (categoryName) { %>
          in <span class="text-blue-600"><%= categoryName %></span>
        <% } %>
      </h2>
      <a href="/shop?category=<%= categoryName %>" 
         class="text-blue-600 hover:text-blue-800 font-semibold flex items-center gap-2 transition">
        View All <i class="fas fa-arrow-right"></i>
      </a>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      <% if (relatedProducts && relatedProducts.length > 0) { %>
        <% relatedProducts.forEach(item => { %>
          <a href="/product/<%= item._id %>" class="block group">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300">
              <!-- Product Image -->
              <div class="relative aspect-square bg-gray-50 overflow-hidden">
                <img src="<%= item.productImage[0] %>" 
                     alt="<%= item.productName %>" 
                     class="w-full h-full object-contain p-4 group-hover:scale-110 transition-transform duration-300">
                
                <% if (item.regularPrice && item.salePrice && item.regularPrice > item.salePrice) { %>
                  <% let discount = Math.round(((item.regularPrice - item.salePrice) / item.regularPrice) * 100); %>
                  <span class="absolute top-3 left-3 bg-red-500 text-white text-xs font-semibold px-2 py-1 rounded-full">
                    <%= discount %>% OFF
                  </span>
                <% } %>
              </div>
              

              <!-- Product Info -->
              <div class="p-4">
                <h3 class="font-semibold text-gray-900 text-sm mb-2 line-clamp-2 leading-tight">
                  <%= item.productName %>
                </h3>
                <p class="text-xs text-gray-500 mb-3"><%= item.brand %></p>

                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    <span class="text-lg font-bold text-gray-900">â‚¹<%= item.salePrice %></span>
                    <% if (item.regularPrice) { %>
                      <span class="text-sm text-gray-500 line-through">â‚¹<%= item.regularPrice %></span>
                    <% } %>
                  </div>

                  <% if (item.rating) { %>
                    <div class="flex items-center gap-1">
                      <i class="fas fa-star text-amber-400 text-xs"></i>
                      <span class="text-xs text-gray-600"><%= item.rating.toFixed(1) %></span>
                    </div>
                  <% } %>
                </div>
              </div>
            </div>
          </a>
        <% }); %>
      <% } else { %>
        <div class="col-span-4 text-center py-12">
          <i class="fas fa-box-open text-4xl text-gray-300 mb-4"></i>
          <p class="text-gray-500">No similar products found in this category.</p>
        </div>
      <% } %>
    </div>
  </div>
</section>


    <!-- Footer -->
    <%-include('../partials/footer')%>

    <script>
//         function selectColor(color) {
//   document.querySelectorAll('.color-option').forEach(option => {
//     option.classList.remove('selected');
//   });
//   document.querySelector(`[data-color="${color}"]`).classList.add('selected');

//   // Fetch variant images dynamically (if stored in backend)
//   fetch(`/user/api/variant-images/${'<%= product._id %>'}?color=${color}`)
//     .then(res => res.json())
//     .then(data => {
//       if (data.success && data.images.length) {
//         const mainImage = document.getElementById('mainImage');
//         mainImage.src = data.images[0];
//         document.getElementById('zoomResultImg').src = data.images[0];
//       }
//     })
//     .catch(console.error);
// }


        let isWishlisted = false;

        
  const variantImages = <%- JSON.stringify(variantImages || {}) %>;

        // Initialize on page load
   
        function moveLens(e) {
            e.preventDefault();
            
            const zoomLens = document.getElementById('zoomLens');
            const zoomResult = document.getElementById('zoomResult');
            const zoomResultImg = document.getElementById('zoomResultImg');
            const mainImage = document.getElementById('mainImage');
            
            const container = mainImage.parentElement;
            const containerRect = container.getBoundingClientRect();
            
            // Calculate cursor position relative to container
            let x = e.clientX - containerRect.left;
            let y = e.clientY - containerRect.top;
            
            // Prevent lens from going outside container
            const lensSize = parseInt(zoomLens.style.width);
            x = Math.max(lensSize / 2, Math.min(x, containerRect.width - lensSize / 2));
            y = Math.max(lensSize / 2, Math.min(y, containerRect.height - lensSize / 2));
            
            // Position lens
            zoomLens.style.left = (x - lensSize / 2) + 'px';
            zoomLens.style.top = (y - lensSize / 2) + 'px';
            
            // Calculate zoom (2.5x zoom for Amazon style)
            const zoomLevel = 2.5;
            const resultWidth = zoomResult.offsetWidth;
            const resultHeight = zoomResult.offsetHeight;
            
            const bgX = (x / containerRect.width) * (mainImage.naturalWidth * zoomLevel - resultWidth);
            const bgY = (y / containerRect.height) * (mainImage.naturalHeight * zoomLevel - resultHeight);
            
            // Position zoom result image
            zoomResultImg.style.left = -bgX + 'px';
            zoomResultImg.style.top = -bgY + 'px';
        }

        // Change Main Image
        function changeMainImage(imgUrl, button) {
            const mainImage = document.getElementById('mainImage');
            const thumbnails = document.querySelectorAll('.thumbnail-btn');
            
            mainImage.src = imgUrl;
            mainImage.setAttribute('data-zoom-src', imgUrl);
            
            // Update active thumbnail
            document.querySelectorAll('button').forEach(btn => {
                if (btn.classList.contains('border-blue-500')) {
                    btn.classList.remove('border-blue-500');
                }
            });
            button.classList.add('border-blue-500');
            
            // Update zoom result image
            document.getElementById('zoomResultImg').src = imgUrl;
        }

        // Select Color

     
async function selectColor(color) {
  // Update UI for color selection
  document.querySelectorAll('.color-option').forEach(option => {
    option.classList.remove('selected');
  });
  document.querySelector(`[data-color="${color}"]`).classList.add('selected');

  try {
    const res = await fetch(`/user/api/variant/${'<%= product._id %>'}?color=${color}`);
    const data = await res.json();

    if (data.success && data.variant) {
      const { images, price, mrp, stock } = data.variant;

      // ðŸ–¼ï¸ Update main image
      const mainImage = document.getElementById('mainImage');
      mainImage.src = images[0];
      document.getElementById('zoomResultImg').src = images[0];

      // ðŸ–¼ï¸ Update thumbnails
      const thumbnailContainer = document.getElementById('thumbnailContainer');
      thumbnailContainer.innerHTML = images.map((img, index) => `
        <button onclick="changeMainImage('${img}', this)"
                class="bg-white rounded-lg overflow-hidden border-2 border-gray-200 hover:border-blue-500 transition-all h-24 ${index === 0 ? 'border-blue-500' : ''}">
          <img src="${img}" alt="Product thumbnail ${index + 1}" class="w-full h-full object-contain p-2">
        </button>
      `).join('');

      // âœ… Only update main product price (not all .text-3xl)
      const productSection = document.querySelector('.info-card.fade-in'); // first product info card
    //   const priceEl = productSection.querySelector('.text-3xl.font-bold.text-gray-900');
    //   const mrpEl = productSection.querySelector('.text-xl.text-gray-500.line-through');
    //   const discountEl = productSection.querySelector('.text-lg.font-semibold.text-green-600');

    //   if (priceEl) priceEl.textContent = `â‚¹${price}`;
    //   if (mrpEl && mrp) {
    //     mrpEl.textContent = `â‚¹${mrp}`;
    //     const discount = Math.round(((mrp - price) / mrp) * 100);
    //     if (discountEl) discountEl.textContent = `Save ${discount}%`;
    //   }
    const priceEl = document.getElementById('productPrice');
const mrpEl = document.getElementById('productMrp');
const discountEl = document.getElementById('productDiscount');

if (priceEl) priceEl.textContent = `â‚¹${price}`;
if (mrpEl && mrp) {
  mrpEl.textContent = `â‚¹${mrp}`;
  const discount = Math.round(((mrp - price) / mrp) * 100);
  if (discountEl) discountEl.textContent = `Save ${discount}%`;
}

      // ðŸ“¦ Update stock
      const stockText = document.querySelector('.text-sm.text-gray-600');
      if (stockText) stockText.innerHTML = `<i class="fas fa-check-circle text-green-500 mr-1"></i>${stock} available in stock`;

      const qtyInput = document.getElementById('quantity');
      qtyInput.max = stock;
    }
  } catch (error) {
    console.error('Error fetching variant data:', error);
  }
}

        // function selectColor(color) {
            // Update active color UI
            // document.querySelectorAll('.color-option').forEach(option => {
            //     option.classList.remove('selected');
            // });
            // document.querySelector(`[data-color="${color}"]`).classList.add('selected');
            
            // In a real application, you would update the product images/variants based on color selection
            // showNotification(`Color changed to ${color}`, 'info');
        // }

        // Helper function to get color values
        // function getColorValue(color) {
        //     const colorMap = {
        //         'black': '#000000',
        //         'blue': '#1e40af',
        //         'red': '#dc2626',
        //         'green': '#059669',
        //         'gray': '#6b7280',
        //         'navy': '#1e3a8a',
        //         'brown': '#92400e',
        //         'white': '#ffffff'
        //     };
        //     return colorMap[color.toLowerCase()] || '#6b7280';
        // }

        // Quantity Functions
        function increaseQty() {
            const qtyInput = document.getElementById('quantity');
            const max = parseInt(qtyInput.max);
            if (parseInt(qtyInput.value) < max) {
                qtyInput.value = parseInt(qtyInput.value) + 1;
            }
        }

        function decreaseQty() {
            const qtyInput = document.getElementById('quantity');
            if (parseInt(qtyInput.value) > 1) {
                qtyInput.value = parseInt(qtyInput.value) - 1;
            }
        }

        // Toggle Wishlist
        function toggleWishlist(productId) {
            const wishlistIcon = document.getElementById('wishlistIcon');
            
            if (isWishlisted) {
                wishlistIcon.classList.replace('fas', 'far');
                wishlistIcon.style.color = '';
            } else {
                wishlistIcon.classList.replace('far', 'fas');
                wishlistIcon.style.color = '#ef4444';
            }
            
            isWishlisted = !isWishlisted;
            
            // Show notification
            showNotification(
                isWishlisted 
                    ? 'Product added to wishlist!' 
                    : 'Product removed from wishlist!', 
                isWishlisted ? 'success' : 'info'
            );
            
            // AJAX call to add/remove from wishlist
            const endpoint = isWishlisted ? '/wishlist/add' : '/wishlist/remove';
            fetch(endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ productId: productId })
            }).catch(console.error);
        }

        // Add to Cart
        function addToCart() {
            const quantity = document.getElementById('quantity').value;
            const color = document.querySelector('.color-option.selected')?.querySelector('.color-name').textContent || 'N/A';
            
            // Show success message
            showNotification(`Added ${quantity} item(s) to cart!`, 'success');
            
            // AJAX call to add to cart
            fetch('/cart/add', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    productId: '<%= product._id %>',
                    quantity: quantity,
                    color: color
                })
            }).catch(console.error);
        }

        // Buy Now
        function buyNow() {
            const quantity = document.getElementById('quantity').value;
            const color = document.querySelector('.color-option.selected')?.querySelector('.color-name').textContent || 'N/A';
            
            // Redirect to checkout
            window.location.href = `/checkout?product=${'<%= product._id %>'}&quantity=${quantity}&color=${color}`;
        }

        function addToWishlist(productId) {
            alert('Added to wishlist!');
        }

        // Notification System
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg text-white font-semibold transform translate-x-full transition-transform duration-300 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
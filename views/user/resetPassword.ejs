<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password | BagHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gray-50 flex flex-col min-h-screen font-sans">
    <!-- Navbar -->
    <nav class="bg-[#024C46] text-white py-4">
      <div class="max-w-7xl mx-auto flex justify-between items-center px-4">
        <div class="flex items-center space-x-8">
          <a href="/" class="hover:underline">Home</a>
          <a href="/shop" class="hover:underline">Shop</a>
          <a href="/contact" class="hover:underline">Contact Us</a>
          <a href="/about" class="hover:underline">About Us</a>
        </div>
        <div class="flex items-center space-x-4 text-xl">
          <i class="ri-shopping-cart-line"></i>
          <i class="ri-user-line"></i>
          <i class="ri-heart-line"></i>
        </div>
      </div>
    </nav>

    <!-- Reset Password Section -->
    <main class="flex-grow flex items-center justify-center py-10 px-4">
      <div class="border-2 border-[#024C46] rounded-2xl p-8 w-[90%] max-w-md bg-white shadow-md text-center">
        <h1 class="text-2xl font-semibold mb-6 tracking-wide text-[#024C46]">Reset Your Password</h1>

        <% if (error) { %>
          <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 text-sm">
            <%= error %>
          </div>
        <% } %>

        <form id="resetForm" action="/user/resetPassword" method="POST" class="space-y-5" novalidate>
          <input type="hidden" name="email" value="<%= email %>" />

          <!-- New Password -->
          <div class="relative text-left">
            <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
            <input
              id="newPassword"
              name="newPassword"
              type="password"
              autocomplete="new-password"
              placeholder="New Password"
              aria-describedby="passwordHelp"
              aria-invalid="false"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#024C46] transition"
              required
            />
            <button type="button" id="toggleNewPwd" class="absolute right-3 top-[38px] text-gray-500 hover:text-gray-800" aria-label="Show or hide new password">
              <!-- icon inserted by JS -->
            </button>
            <p id="passwordError" class="text-xs text-red-600 mt-1 hidden" role="alert">
              Password must be at least 8 chars, include an uppercase letter, a number, and a special character.
            </p>
          </div>

          <!-- Confirm Password -->
          <div class="relative text-left">
            <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
            <input
              id="confirmPassword"
              name="confirmPassword"
              type="password"
              autocomplete="new-password"
              placeholder="Confirm Password"
              aria-describedby="confirmHelp"
              aria-invalid="false"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#024C46] transition"
              required
            />
            <button type="button" id="toggleConfirmPwd" class="absolute right-3 top-[38px] text-gray-500 hover:text-gray-800" aria-label="Show or hide confirm password"></button>
            <p id="confirmError" class="text-xs text-red-600 mt-1 hidden" role="alert">Passwords do not match.</p>
          </div>

          <!-- Submit -->
          <button
            type="submit"
            id="submitBtn"
            disabled
            class="w-full bg-[#024C46] text-white py-3 rounded-lg font-semibold hover:bg-[#013f3a] transition disabled:opacity-50"
          >
            Submit
          </button>
        </form>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-[#024C46] text-white py-10 mt-auto">
      <div class="max-w-7xl mx-auto px-6 grid md:grid-cols-5 gap-6 text-sm">
        <div>
          <h2 class="font-bold text-lg mb-2">SHOP</h2>
          <p><a href="#">Indoor Plants</a></p>
          <p><a href="#">Outdoor Plants</a></p>
        </div>
        <div>
          <h2 class="font-bold text-lg mb-2">SUPPORT</h2>
          <p><a href="#">Order Status</a></p>
          <p><a href="#">Product Support</a></p>
          <p><a href="#">Shipping & Return Policy</a></p>
          <p><a href="#">Complaint Registration</a></p>
        </div>
        <div>
          <h2 class="font-bold text-lg mb-2">About Us</h2>
          <p><a href="#">Contact Us</a></p>
          <p><a href="#">Privacy Policy</a></p>
          <p><a href="#">Terms of Use</a></p>
          <p><a href="#">FAQ</a></p>
        </div>
        <div>
          <h2 class="font-bold text-lg mb-2">Contact</h2>
          <p>Email: baghub@gmail.com</p>
          <p>Phone: +91 8888888888</p>
        </div>
        <div>
          <h2 class="font-bold text-lg mb-2">Connect with us</h2>
          <div class="flex space-x-4 text-xl">
            <i class="ri-instagram-line"></i>
            <i class="ri-facebook-box-line"></i>
            <i class="ri-twitter-x-line"></i>
          </div>
        </div>
      </div>
      <p class="text-center mt-8 text-xs opacity-80">© 2025 BagHub. All Rights Reserved.</p>
    </footer>

    <script>
      (function () {
        const newPwd = document.getElementById('newPassword');
        const confirmPwd = document.getElementById('confirmPassword');
        const pwdError = document.getElementById('passwordError');
        const confError = document.getElementById('confirmError');
        const submitBtn = document.getElementById('submitBtn');
        const toggleNew = document.getElementById('toggleNewPwd');
        const toggleConf = document.getElementById('toggleConfirmPwd');

        // track touched state so errors don't show immediately
        const touched = { newPwd: false, confirmPwd: false };

        // password strength regex: 8+, uppercase, digit, special
        const pwdRegex = /^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]).{8,}$/;

        // set toggle icons
        const eye = (target) => {
          target.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.27 2.943 9.543 7-1.273 4.057-5.065 7-9.543 7-4.477 0-8.268-2.943-9.542-7z"/></svg>';
        };
        const eyeSlash = (target) => {
          target.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.27-2.943-9.543-7a11.864 11.864 0 012.223-3.507M6.6 6.6A9.953 9.953 0 0112 5c4.478 0 8.27 2.943 9.543 7a10.07 10.07 0 01-1.133 2.49M3 3l18 18"/></svg>';
        };

        // initialize icons
        eye(toggleNew);
        eye(toggleConf);

        // utility: update UI state for field
        function markValid(el) {
          el.classList.remove('border-red-400');
          el.classList.add('border-green-400');
          el.setAttribute('aria-invalid', 'false');
        }
        function markInvalid(el) {
          el.classList.remove('border-green-400');
          el.classList.add('border-red-400');
          el.setAttribute('aria-invalid', 'true');
        }
        function clearMark(el) {
          el.classList.remove('border-red-400', 'border-green-400');
          el.setAttribute('aria-invalid', 'false');
        }

        // validate new password value (returns {ok, message})
        function validateNew(value) {
          if (!value) return { ok: false, message: 'Password is required.' };
          if (!pwdRegex.test(value)) return { ok: false, message: 'Password must be ≥8 chars, include uppercase, number & special char.' };
          return { ok: true, message: '' };
        }

        // validate confirm password
        function validateConfirm(value, newVal) {
          if (!value) return { ok: false, message: 'Please confirm your password.' };
          if (value !== newVal) return { ok: false, message: 'Passwords do not match.' };
          return { ok: true, message: '' };
        }

        // run overall validation and enable/disable submit
        function runValidation() {
          const newVal = newPwd.value.trim();
          const confVal = confirmPwd.value.trim();

          const newRes = validateNew(newVal);
          const confRes = validateConfirm(confVal, newVal);

          // new password UI
          if (touched.newPwd) {
            if (newRes.ok) {
              pwdError.classList.add('hidden');
              markValid(newPwd);
            } else {
              pwdError.textContent = newRes.message;
              pwdError.classList.remove('hidden');
              markInvalid(newPwd);
            }
          } else {
            // if not touched, only clear styles
            clearMark(newPwd);
            pwdError.classList.add('hidden');
          }

          // confirm UI
          if (touched.confirmPwd) {
            if (confRes.ok) {
              confError.classList.add('hidden');
              markValid(confirmPwd);
            } else {
              confError.textContent = confRes.message;
              confError.classList.remove('hidden');
              markInvalid(confirmPwd);
            }
          } else {
            clearMark(confirmPwd);
            confError.classList.add('hidden');
          }

          // enable submit only when both valid
          submitBtn.disabled = !(newRes.ok && confRes.ok);
        }

        // input listeners (real-time)
        newPwd.addEventListener('input', () => {
          // if user typed, mark touched so they see feedback quickly
          // but still respect blur behavior for not-too-early errors
          runValidation();
        });
        confirmPwd.addEventListener('input', () => {
          runValidation();
        });

        // blur listeners mark touched and show errors immediately if invalid
        newPwd.addEventListener('blur', () => {
          touched.newPwd = true;
          runValidation();
        });
        confirmPwd.addEventListener('blur', () => {
          touched.confirmPwd = true;
          runValidation();
        });

        // toggle show/hide
        toggleNew.addEventListener('click', () => {
          if (newPwd.type === 'password') {
            newPwd.type = 'text';
            eyeSlash(toggleNew);
          } else {
            newPwd.type = 'password';
            eye(toggleNew);
          }
          newPwd.focus();
        });
        toggleConf.addEventListener('click', () => {
          if (confirmPwd.type === 'password') {
            confirmPwd.type = 'text';
            eyeSlash(toggleConf);
          } else {
            confirmPwd.type = 'password';
            eye(toggleConf);
          }
          confirmPwd.focus();
        });

        // prohibit form submission if invalid (extra safety)
        const form = document.getElementById('resetForm');
        form.addEventListener('submit', (e) => {
          // force marking touched so errors display
          touched.newPwd = true;
          touched.confirmPwd = true;
          runValidation();
          if (submitBtn.disabled) {
            e.preventDefault();
            // focus the first invalid field
            if (newPwd.classList.contains('border-red-400')) newPwd.focus();
            else if (confirmPwd.classList.contains('border-red-400')) confirmPwd.focus();
          }
        });

        // initial validation state
        runValidation();
      })();
    </script>
  </body>
</html>
